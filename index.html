<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform C - Video Player Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }

        .header { background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 20px; box-shadow: 0 2px 20px rgba(0,0,0,.5); }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .badge { background: rgba(76,175,80,.2); color: #4caf50; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; }

        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }

        .card { background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 20px; padding: 40px; margin-bottom: 32px; box-shadow: 0 10px 40px rgba(0,0,0,.3); }
        .card-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        input[type="url"] { width: 100%; padding: 16px 20px; background: rgba(255,255,255,.05); border: 2px solid rgba(255,255,255,.1); border-radius: 12px; color: #fff; font-size: 15px; margin-bottom: 20px; transition: border-color .2s; }
        input:focus { outline: none; border-color: #667eea; }
        input::placeholder { color: rgba(255,255,255,.35); }

        .btn { padding: 16px 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform .2s, opacity .2s; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:disabled { opacity: .55; cursor: not-allowed; }

        .sec-badge { display: inline-block; background: rgba(76,175,80,.15); color: #4caf50; border: 1px solid rgba(76,175,80,.3); padding: 7px 16px; border-radius: 8px; font-size: 12px; margin-top: 14px; }

        .error { background: rgba(244,67,54,.15); border: 1px solid rgba(244,67,54,.3); color: #f44336; padding: 14px 18px; border-radius: 12px; margin-top: 16px; display: none; }

        /* ‚îÄ‚îÄ Player ‚îÄ‚îÄ */
        #videoSection { display: none; }
        #videoSection.active { display: block; }

        .player-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 22px; }
        .player-title { font-size: 22px; font-weight: 700; }
        .close-btn { padding: 9px 20px; background: rgba(255,59,48,.18); color: #ff3b30; border: 1px solid rgba(255,59,48,.25); border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: background .2s; }
        .close-btn:hover { background: rgba(255,59,48,.3); }

        .player-wrap { position: relative; padding-bottom: 56.25%; height: 0; background: #000; border-radius: 16px; overflow: hidden; }
        video, iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: none; }

        /* Invisible overlay ‚Äî blocks right-click "Save video as" on the raw surface */
        .overlay { position: absolute; inset: 0; z-index: 10; background: transparent; pointer-events: none; }

        /* Token expiry bar */
        .token-bar-wrap { margin-top: 10px; background: rgba(255,255,255,.06); border-radius: 6px; height: 4px; overflow: hidden; }
        .token-bar { height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); border-radius: 6px; transition: width 10s linear; }
        .token-label { font-size: 11px; color: rgba(255,255,255,.35); margin-top: 5px; text-align: right; }

        /* Spinner */
        #loadingSection { display: none; text-align: center; padding: 60px; color: rgba(255,255,255,.55); }
        .spinner { width: 50px; height: 50px; border: 3px solid rgba(255,255,255,.1); border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 18px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* DRM */
        * { -webkit-user-select: none; -moz-user-select: none; user-select: none; }
        input[type="url"] { -webkit-user-select: text; -moz-user-select: text; user-select: text; }
        video, img, iframe { -webkit-user-drag: none; user-drag: none; }
    </style>
</head>
<body>

<div class="header">
    <div class="header-content">
        <div class="logo">üé¨ Video Player Pro</div>
        <div class="badge">üîí Fully Protected</div>
    </div>
</div>

<div class="container">

    <div class="card">
        <div class="card-title">Load Your Secure Video</div>
        <input type="url" id="videoUrl"
               placeholder="Paste your Platform B video URL‚Ä¶ (e.g. https://platform-b.vercel.app/video/abc123)">
        <button class="btn" id="loadBtn">‚ñ∂Ô∏è Load Video</button>
        <div class="sec-badge">üõ°Ô∏è Original URLs never exposed ¬∑ Signed stream URLs expire in 2h</div>
        <div class="error" id="error"></div>
    </div>

    <div id="loadingSection">
        <div class="spinner"></div>
        <p>Connecting to secure stream‚Ä¶</p>
    </div>

    <div id="videoSection" class="card">
        <div class="player-header">
            <div class="player-title">Now Playing</div>
            <button class="close-btn" id="closeBtn">‚úï Close</button>
        </div>
        <div class="player-wrap">
            <video id="videoPlayer"
                   controls playsinline preload="metadata"
                   controlsList="nodownload nofullscreen noremoteplayback"
                   disablePictureInPicture
                   oncontextmenu="return false;"></video>
            <iframe id="iframePlayer" allowfullscreen allow="autoplay"
                    oncontextmenu="return false;"></iframe>
            <div class="overlay" oncontextmenu="return false;"></div>
        </div>
        <div class="token-bar-wrap" id="tokenBarWrap" style="display:none">
            <div class="token-bar" id="tokenBar" style="width:100%"></div>
        </div>
        <div class="token-label" id="tokenLabel"></div>
    </div>

</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  CONFIG  (must match Platform B)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SEC = '84418779257393762955868022673598';

let _tokenTimer  = null;   // interval that shrinks the expiry bar
let _tokenExpiry = 0;      // ms timestamp when current token expires

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  HELPERS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function norm(url) { return url.replace(/([^:])\/\/+/g, '$1/'); }

function showErr(msg) {
    const el = document.getElementById('error');
    el.textContent = '‚ùå ' + msg;
    el.style.display = 'block';
    setTimeout(() => { el.style.display = 'none'; }, 8000);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  TOKEN EXPIRY BAR
//  Shrinks over 2 hours so user can see the session countdown.
//  Near expiry the player auto-refreshes the token silently.
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _videoId  = null;
let _baseUrl  = null;

function startTokenBar(expiresInSec) {
    _tokenExpiry = Date.now() + expiresInSec * 1000;
    const bar    = document.getElementById('tokenBar');
    const wrap   = document.getElementById('tokenBarWrap');
    const label  = document.getElementById('tokenLabel');
    wrap.style.display = 'block';
    bar.style.width    = '100%';

    clearInterval(_tokenTimer);
    _tokenTimer = setInterval(async () => {
        const remaining = Math.max(0, _tokenExpiry - Date.now());
        const pct       = (remaining / (expiresInSec * 1000)) * 100;
        bar.style.width = pct + '%';

        const mins = Math.floor(remaining / 60000);
        label.textContent = remaining > 0
            ? 'Stream token valid for ' + (mins > 0 ? mins + 'm ' : '') + Math.floor((remaining % 60000) / 1000) + 's'
            : 'Token expired ‚Äî reloading‚Ä¶';

        // Auto-refresh token when 5 minutes remain
        if (remaining < 5 * 60 * 1000 && remaining > 0) {
            await refreshStreamToken();
        }
        if (remaining <= 0) clearInterval(_tokenTimer);
    }, 1000);
}

// Silently refreshes the stream token and updates the video src
// without interrupting playback (currentTime is preserved)
async function refreshStreamToken() {
    if (!_videoId || !_baseUrl) return;
    const vid = document.getElementById('videoPlayer');
    try {
        const res  = await fetch(norm(_baseUrl + '/api/video/' + _videoId), {
            headers: { 'X-Security-String': SEC }
        });
        if (!res.ok) return;
        const data = await res.json();
        if (!data.success || data.type !== 'video') return;

        // Swap src without seeking ‚Äî save position, update src, seek back
        const wasPlaying = !vid.paused;
        const savedTime  = vid.currentTime;
        vid.src          = data.streamUrl;
        vid.load();
        vid.currentTime  = savedTime;
        if (wasPlaying) vid.play().catch(() => {});

        _tokenExpiry = Date.now() + (data.tokenExpiresIn || 7200) * 1000;
    } catch (_) {}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  LOAD VIDEO
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadVideo() {
    const url  = document.getElementById('videoUrl').value.trim();
    const btn  = document.getElementById('loadBtn');
    const load = document.getElementById('loadingSection');
    const sec  = document.getElementById('videoSection');
    const vid  = document.getElementById('videoPlayer');
    const ifr  = document.getElementById('iframePlayer');

    if (!url || !url.includes('/video/')) {
        showErr('Invalid URL ‚Äî must contain /video/'); return;
    }

    // Reset
    document.getElementById('error').style.display = 'none';
    sec.classList.remove('active');
    load.style.display = 'block';
    btn.disabled = true;
    clearInterval(_tokenTimer);

    try {
        const m = url.match(/\/video\/([^/?#]+)/);
        if (!m) throw new Error('Could not extract video ID');
        _videoId = m[1];
        _baseUrl = url.substring(0, url.indexOf('/video/'));

        const res = await fetch(norm(_baseUrl + '/api/video/' + _videoId), {
            headers: { 'X-Security-String': SEC, 'Content-Type': 'application/json' }
        });
        if (res.status === 403) throw new Error('Access denied ‚Äî check security key');
        if (res.status === 404) throw new Error('Video not found');
        if (!res.ok)            throw new Error('Server error ' + res.status);

        const data = await res.json();
        if (!data.success) throw new Error(data.message || 'Failed to load');

        load.style.display = 'none';
        sec.classList.add('active');
        btn.disabled = false;

        if (data.type === 'embed') {
            // YouTube / Vimeo / Dailymotion
            ifr.src = norm(data.proxyUrl) + '?key=' + encodeURIComponent(SEC);
            ifr.style.display = 'block';
            vid.style.display = 'none';
            document.getElementById('tokenBarWrap').style.display = 'none';
            document.getElementById('tokenLabel').textContent     = '';

        } else {
            // Direct video ‚Äî set src directly, browser handles ALL byte-range requests
            // This is native streaming: instant seek, no JS buffering loops, no chunk math
            vid.style.display = 'block';
            ifr.style.display = 'none';
            vid.src           = data.streamUrl;
            vid.load();

            startTokenBar(data.tokenExpiresIn || 7200);
        }

    } catch (e) {
        load.style.display = 'none';
        btn.disabled = false;
        showErr(e.message);
    }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  CLOSE VIDEO
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function closeVideo() {
    clearInterval(_tokenTimer);
    const vid = document.getElementById('videoPlayer');
    const ifr = document.getElementById('iframePlayer');
    document.getElementById('videoSection').classList.remove('active');
    document.getElementById('tokenBarWrap').style.display = 'none';
    document.getElementById('tokenLabel').textContent     = '';
    if (vid) { vid.pause(); vid.removeAttribute('src'); vid.load(); }
    if (ifr) ifr.src = '';
    _videoId = _baseUrl = null;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  EVENT LISTENERS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('loadBtn') .addEventListener('click',   loadVideo);
document.getElementById('closeBtn').addEventListener('click',   closeVideo);
document.getElementById('videoUrl').addEventListener('keypress', e => { if (e.key === 'Enter') loadVideo(); });

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  ANTI-DOWNLOAD / ANTI-RECORD PROTECTIONS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// 1. Block right-click everywhere
document.addEventListener('contextmenu', e => { e.preventDefault(); return false; });

// 2. Block keyboard shortcuts (download, inspect, print, screenshot)
document.addEventListener('keydown', e => {
    const k = e.key.toLowerCase();
    if ((e.ctrlKey || e.metaKey) && ['s','u','p','i','j','c'].includes(k)) { e.preventDefault(); return false; }
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && ['i','j','c'].includes(k)) { e.preventDefault(); return false; }
    if (['f12','printscreen'].includes(k)) { e.preventDefault(); return false; }
    if (e.metaKey && k === 'g') { e.preventDefault(); return false; }  // Win+G game bar
    if (e.metaKey && e.altKey && k === 'r') { e.preventDefault(); return false; } // Win+Alt+R recording
});

// 3. Block drag-to-desktop
document.addEventListener('dragstart', e => { e.preventDefault(); return false; });

// 4. Pause video when tab is hidden (prevents background capture tools)
document.addEventListener('visibilitychange', () => {
    const v = document.getElementById('videoPlayer');
    if (v && document.hidden) v.pause();
});

// 5. Block screen capture APIs (used by browser extensions)
if (navigator.mediaDevices) {
    try {
        Object.defineProperty(navigator.mediaDevices, 'getDisplayMedia', {
            configurable: false, writable: false,
            value: () => Promise.reject(new DOMException('Not allowed', 'NotAllowedError'))
        });
    } catch (_) {}
    try {
        const _gum = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
        Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
            configurable: false, writable: false,
            value: c => (c?.video)
                ? Promise.reject(new DOMException('Not allowed', 'NotAllowedError'))
                : _gum(c)
        });
    } catch (_) {}
}

// 6. Disable MediaRecorder (in-browser recording)
try {
    Object.defineProperty(window, 'MediaRecorder', {
        configurable: false, writable: false,
        value: function() { throw new DOMException('Disabled', 'NotSupportedError'); }
    });
} catch (_) {}

// 7. DevTools detection ‚Äî hide and pause video if DevTools open
(function() {
    const THRESHOLD = 160;
    let devOpen = false;
    setInterval(() => {
        const open = window.outerWidth  - window.innerWidth  > THRESHOLD
                  || window.outerHeight - window.innerHeight > THRESHOLD;
        const v = document.getElementById('videoPlayer');
        const f = document.getElementById('iframePlayer');
        if (open && !devOpen) {
            devOpen = true;
            if (v) { v.pause(); v.style.visibility = 'hidden'; }
            if (f) f.style.visibility = 'hidden';
        } else if (!open && devOpen) {
            devOpen = false;
            if (v) v.style.visibility = 'visible';
            if (f) f.style.visibility = 'visible';
        }
    }, 800);
})();
</script>
</body>
</html>
